<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FlappyBird-like Game (Mobile)</title>
    <style>
        body { margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f0f0f0; overflow: hidden; }
        #game { max-width: 100%; max-height: 100vh; touch-action: none; }
    </style>
</head>
<body>
    <svg id="game" width="400" height="600" viewBox="0 0 400 600">
        <rect width="400" height="600" fill="#87CEEB"/>
        <circle id="bird" cx="100" cy="300" r="20" fill="yellow"/>
        <text id="score" x="20" y="40" font-family="Arial" font-size="20" fill="white">Score: 0</text>
        <text id="instruction" x="200" y="570" font-family="Arial" font-size="16" fill="white" text-anchor="middle">タップしてスタート</text>
    </svg>

    <script>
        const svg = document.getElementById('game');
        const bird = document.getElementById('bird');
        const scoreText = document.getElementById('score');
        const instructionText = document.getElementById('instruction');
        let birdY = 300;
        let birdVelocity = 0;
        let score = 0;
        let gameStarted = false;
        const gravity = 0.5;
        const jump = -10;
        const pipeWidth = 60;
        const pipeGap = 200;
        let pipes = [];
        let gameLoop;

        function resizeGame() {
            const windowRatio = window.innerWidth / window.innerHeight;
            const gameRatio = 400 / 600;
            if (windowRatio < gameRatio) {
                svg.style.width = '100vw';
                svg.style.height = 'auto';
            } else {
                svg.style.width = 'auto';
                svg.style.height = '100vh';
            }
        }

        function createPipe() {
            const pipeHeight = Math.random() * 300 + 100;
            const topPipe = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            const bottomPipe = document.createElementNS("http://www.w3.org/2000/svg", "rect");

            topPipe.setAttribute("width", pipeWidth);
            topPipe.setAttribute("height", pipeHeight);
            topPipe.setAttribute("x", 400);
            topPipe.setAttribute("y", 0);
            topPipe.setAttribute("fill", "green");

            bottomPipe.setAttribute("width", pipeWidth);
            bottomPipe.setAttribute("height", 600 - pipeHeight - pipeGap);
            bottomPipe.setAttribute("x", 400);
            bottomPipe.setAttribute("y", pipeHeight + pipeGap);
            bottomPipe.setAttribute("fill", "green");

            svg.appendChild(topPipe);
            svg.appendChild(bottomPipe);

            pipes.push({ top: topPipe, bottom: bottomPipe, x: 400 });
        }

        function movePipes() {
            pipes.forEach((pipe, index) => {
                pipe.x -= 2;
                pipe.top.setAttribute("x", pipe.x);
                pipe.bottom.setAttribute("x", pipe.x);

                if (pipe.x + pipeWidth < 0) {
                    svg.removeChild(pipe.top);
                    svg.removeChild(pipe.bottom);
                    pipes.splice(index, 1);
                    score++;
                    scoreText.textContent = `Score: ${score}`;
                }

                if (
                    pipe.x < 120 && pipe.x + pipeWidth > 80 &&
                    (birdY < pipe.top.height.baseVal.value + 20 ||
                     birdY > pipe.top.height.baseVal.value + pipeGap - 20)
                ) {
                    gameOver();
                }
            });
        }

        function gameOver() {
            cancelAnimationFrame(gameLoop);
            alert(`Game Over! Your score: ${score}`);
            location.reload();
        }

        function update() {
            birdVelocity += gravity;
            birdY += birdVelocity;
            bird.setAttribute("cy", birdY);

            if (birdY > 580 || birdY < 20) {
                gameOver();
            }

            movePipes();

            gameLoop = requestAnimationFrame(update);
        }

        function startGame() {
            if (!gameStarted) {
                gameStarted = true;
                instructionText.style.display = 'none';
                setInterval(createPipe, 3000);
                update();
            }
            birdVelocity = jump;
        }

        svg.addEventListener("touchstart", function(event) {
            event.preventDefault();
            startGame();
        });

        document.addEventListener("keydown", (event) => {
            if (event.code === "Space") {
                event.preventDefault();
                startGame();
            }
        });

        window.addEventListener('resize', resizeGame);
        resizeGame();
    </script>
</body>
</html>
